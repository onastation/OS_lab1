Лабораторная работа №1
Аллокатор памяти общего назначения
Реализация аллокатора памяти общего назначения основана на двусвязном списке: каждый блок содержит ссылку на предыдущий и следующий.
Память, над которой прозводит операции аллокатор делится на блоки. Каждый блок имеет хедер, который содержит информацию о данном блоке.
is_available (1 byte) - проверка, занят ли блок
size (2 byte) - размер блока
previous_size (2 byte) - размер предыдущего блока
По причине выравнивания данных размер хедера составляет 8 байтов.
Реализация
При создании аллокатор запрашивает кусок памяти, используя стандартный аллокатор С++.
mem_alloc(size_t size)
Выделение области памяти размером size. Если аллокатор не может выделить блок запрашиваемого размера, то возвращается nullptr.
Выделенная память должна быть выровнена. В данной реализации каждый блок выровнен по 4 байта. Поиск доступного блока производится с помощью метода первого походящего (поиск завершается, когда найден первый подходящий блок). Когда блок найден, он разделяется на два: один - для данных, а другой - для последующего выделения памяти.
mem_free(void* addr)
Освобождение выделенного по адресу addr блока памяти.
Полученный функцией адрес проверяется во избежание освобождения неправильного блока. После освобождения блока аллокатор пытается произвести дефрагментацию памяти путем его слияния с соседними блоками, если те свободны.
mem_free()
Освобождение всей выделенной памяти производится путем слияния всех блоков в один.
mem_realloc(void* addr, size_t size)
Перераспределение блока памяти по адресу addr с новым размером size.
Для перераспределения блока памяти мы сначала проверяем адрес и проверяем блок на возможность осуществления реаллокации памяти. Если места не хватает даже после слияния со свободными соседними блоками, аллокатор пытается выделить память, используя mem_alloc(size_t size).
Примеры
Код (аллокация) :
https://user-images.githubusercontent.com/43548404/96850273-4ced4980-145f-11eb-92cc-63d98059852d.png
Результат:
https://user-images.githubusercontent.com/43548404/96850282-4e1e7680-145f-11eb-82c3-6c74d02c9fe5.png

Код (освобождение):
https://user-images.githubusercontent.com/43548404/96850287-4f4fa380-145f-11eb-9afb-81c56b4fddd1.png
Результат:
https://user-images.githubusercontent.com/43548404/96850290-5080d080-145f-11eb-8eac-b93188d47586.png

Код(реаллокация):
https://user-images.githubusercontent.com/43548404/96850295-51b1fd80-145f-11eb-8f0a-bed1824aa1d9.png
Результат:
https://user-images.githubusercontent.com/43548404/96850303-52e32a80-145f-11eb-8db7-da3cf383c891.png
